<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CINEWAVE</title>

  <!-- Google Font -->
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BBH+Sans+Bogle&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

  <link rel="stylesheet" href="../css/movies.css">
  <script src="../js/movie-card-component.js" defer></script>
</head>
<body>
<header>
  <nav class="navbar">
    <a href="../index.html" class="logo">
      <span class="cine">CINE</span><span class="wave">WAVE</span>
    </a>

    <div class="nav-links">
      <a href="movies.html">Кино</a>
      <a href="customlist.html">Жагсаалт</a>
      <a href="help.html">Тусламж</a>

      <div class="search-group">
        <div class="all-dropdown">
          <select id="category-select" class="category-select">
            <option value="all">Бүгд</option>
            <option value="movies">Кино</option>
            <option value="tv">TV цуврал</option>
            <option value="celebs">Алдартнууд</option>
          </select>
        </div>
        <div class="search-box">
          <input type="text" placeholder="Хайх..." id="search-input">
        </div>
      </div>

    <button class="hamburger" id="hamburger" aria-label="Menu">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4 7L20 7" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"/>
    <path d="M4 12H20" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"/>
    <path d="M4 17H20" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>

    <button class="sign-in" onclick="window.location.href='./html/login.html'">Нэвтрэх</button>
  </nav>
</header>
<main>
    <h1 class="page-title">Кинонууд</h1>
    <p class="page-subtitle">6,000+ кино, цувралуудыг сонирхлоороо сонгоно уу</p>
    
    <!-- CATEGORY FILTERS -->
    <div class="category-filters">
        <button class="category-btn active" data-category="all">Бүгд</button>
        <button class="category-btn" data-category="movies">Кино</button>
        <button class="category-btn" data-category="tv">TV Цуврал</button>
    </div>
    
    <!-- GENRE FILTERS -->
    <div class="genre-filters">
    </div>
    
    <!-- 6-COLUMN MOVIES GRID -->
    <div class="movies-grid" id="movies-container">
        <!-- Movie cards will be dynamically inserted here -->
    </div>
</main>
<footer class="footer">
  <div class="footer-container">
    <div class="footer-column brand">
      <span class="cine">CINE</span><span class="wave">WAVE</span>
    </div>

    <div class="footer-column">
      <h3>Кино</h3>
      <ul>
        <li><a href="#">Хайх</a></li>
        <li><a href="#">Эрэлтэд</a></li>
        <li><a href="#">Өндөр үнэлгээтэй</a></li>
        <li><a href="#">Шинэ гаралтууд</a></li>
      </ul>
    </div>

    <div class="footer-column">
      <h3>Community</h3>
      <ul>
        <li><a href="#">Найзууд</a></li>
        <li><a href="#">Жагсаалт</a></li>
        <li><a href="#">Хэлэлцүүлэг</a></li>
        <li><a href="#">Шүүмж</a></li>
      </ul>
    </div>

    <div class="footer-column">
      <h3>Компани</h3>
      <ul>
        <li><a href="#">Бидний тухай</a></li>
        <li><a href="#">Ажлын байр</a></li>
        <li><a href="#">Холбоо барих</a></li>
        <li><a href="#">Биднийг дэмжих</a></li>
      </ul>
    </div>

    <div class="footer-column newsletter">
      <h3>Сонин</h3>
      <p>Сүүлийн үеийн кино урлагийн талаарх мэдлэгийг таны гарт.</p>
      <form class="newsletter-form">
        <input type="email" placeholder="Enter your email" required>
        <button type="submit">Subscribe</button>
      </form>
    </div>
  </div>

  <hr class="line">
  <div class="footer-bottom">
    <p>© 2025 CineWave. All rights reserved.</p>

    <div class="footer-socials">
      <a href="#"><i class="fab fa-facebook-f"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-x-twitter"></i></a>
      <a href="#"><i class="fab fa-linkedin-in"></i></a>
      <a href="#"><i class="fab fa-youtube"></i></a>
    </div>
  </div>
</footer>
<script>
// MOVIE DATABASE - MATCHING YOUR STRUCTURE
const database = [
  // Сүүлд нэмэгдсэн кино
  { 
    name: "The Conjuring: Last Rites", 
    category: "movies", 
    image: "movie1.jpg", 
    yearOrSeason: "2025 • 135 мин",
    genre: ["horror", "thriller"]
  },
  { 
    name: "Tron: Ares", 
    category: "movies", 
    image: "movie2.jpg", 
    yearOrSeason: "2025 • 119 мин",
    genre: ["sci-fi", "action", "adventure"]
  },
  { 
    name: "The Fantastic Four: First Steps", 
    category: "movies", 
    image: "movie3.jpg", 
    yearOrSeason: "2025 • 115 мин",
    genre: ["action", "adventure", "sci-fi"]
  },
  { 
    name: "Mission Impossible: The Final Reckoning", 
    category: "movies", 
    image: "movie4.jpg", 
    yearOrSeason: "2025 • 169 мин",
    genre: ["action", "thriller", "adventure"]
  },
  { 
    name: "Superman", 
    category: "movies", 
    image: "movie5.jpg", 
    yearOrSeason: "2025 • 129 мин",
    genre: ["action", "adventure", "sci-fi"]
  },
  { 
    name: "Weapons", 
    category: "movies", 
    image: "movie6.jpg", 
    yearOrSeason: "2025 • 128 мин",
    genre: ["horror", "thriller", "mystery"]
  },
  { 
    name: "The Woman in Cabin 10", 
    category: "movies", 
    image: "thewomanincabin.jpg", 
    yearOrSeason: "2025 • 95 мин",
    genre: ["thriller", "mystery", "drama"]
  },

  // Сүүлд нэмэгдсэн TV цуврал
  { 
    name: "Monster", 
    category: "tv", 
    image: "monster.jpg", 
    yearOrSeason: "Улирал: 3 • Анги: 8",
    genre: ["crime", "drama", "thriller"]
  },
  { 
    name: "The Chair Company", 
    category: "tv", 
    image: "thechaircompany.jpg", 
    yearOrSeason: "Улирал: 1 • Анги: 1",
    genre: ["comedy", "drama"]
  },
  { 
    name: "Allen Iv3rson", 
    category: "tv", 
    image: "iverson.jpg", 
    yearOrSeason: "Улирал: 1 • Анги: 1",
    genre: ["drama", "sport", "biography"]
  },
  { 
    name: "Nobody Wants This", 
    category: "tv", 
    image: "nobodywantsthis.jpg", 
    yearOrSeason: "Улирал: 2 • Анги: 1",
    genre: ["comedy", "romance"]
  },
  { 
    name: "The Diplomat", 
    category: "tv", 
    image: "thediplomat.jpg", 
    yearOrSeason: "Улирал: 3 • Анги: 8",
    genre: ["drama", "thriller", "political"]
  },
  { 
    name: "Wednesday", 
    category: "tv", 
    image: "wednesday.jpg", 
    yearOrSeason: "Улирал: 2 • Анги: 8",
    genre: ["comedy", "fantasy", "horror"]
  },

  // Тун удахгүй гарах кино, TV цуврал
  { 
    name: "Springsteen: Deliver Me from Nowhere", 
    category: "movies", 
    image: "springsteen.jpg", 
    yearOrSeason: "2025 • 120 мин",
    genre: ["drama", "music", "biography"]
  },
  { 
    name: "Regretting You", 
    category: "movies", 
    image: "regrettingyou.jpg", 
    yearOrSeason: "2025 • 116 мин",
    genre: ["drama", "romance"]
  },
  { 
    name: "Physical: 100", 
    category: "tv", 
    image: "physical100.jpg", 
    yearOrSeason: "Улирал: 3 • Анги: 1",
    genre: ["reality", "sport", "competition"]
  },
  { 
    name: "It: Welcome to Derry", 
    category: "tv", 
    image: "welcometoderry.jpg", 
    yearOrSeason: "Улирал: 1 • Анги: 1",
    genre: ["horror", "drama", "fantasy"]
  },
  { 
    name: "Blue Moon", 
    category: "movies", 
    image: "bluemoon.jpg", 
    yearOrSeason: "2025 • 100 мин",
    genre: ["drama", "romance"]
  },
  { 
    name: "Talamasca: The Secret Order", 
    category: "tv", 
    image: "talamasca.jpg", 
    yearOrSeason: "Улирал: 1 • Анги: 1",
    genre: ["fantasy", "drama", "mystery"]
  },

  // ADDING MORE MOVIES TO FILL THE 6-COLUMN GRID
  { 
    name: "Oppenheimer", 
    category: "movies", 
    image: "oppenheimer.jpg", 
    yearOrSeason: "2023 • 180 мин",
    genre: ["drama", "biography", "history"]
  },
  { 
    name: "Barbie", 
    category: "movies", 
    image: "barbie.jpg", 
    yearOrSeason: "2023 • 114 мин",
    genre: ["comedy", "adventure", "fantasy"]
  },
  { 
    name: "John Wick: Chapter 4", 
    category: "movies", 
    image: "johnwick4.jpg", 
    yearOrSeason: "2023 • 169 мин",
    genre: ["action", "thriller", "crime"]
  },
  { 
    name: "Avatar: The Way of Water", 
    category: "movies", 
    image: "avatar2.jpg", 
    yearOrSeason: "2022 • 192 мин",
    genre: ["sci-fi", "adventure", "fantasy"]
  },
  { 
    name: "Stranger Things", 
    category: "tv", 
    image: "strangerthings.jpg", 
    yearOrSeason: "Улирал: 4 • Анги: 9",
    genre: ["drama", "fantasy", "horror"]
  },
  { 
    name: "The Last of Us", 
    category: "tv", 
    image: "thelastofus.jpg", 
    yearOrSeason: "Улирал: 1 • Анги: 9",
    genre: ["drama", "adventure", "horror"]
  },
  { 
    name: "The Batman", 
    category: "movies", 
    image: "thebatman.jpg", 
    yearOrSeason: "2022 • 176 мин",
    genre: ["action", "crime", "drama"]
  },
  { 
    name: "Everything Everywhere All at Once", 
    category: "movies", 
    image: "eeaao.jpg", 
    yearOrSeason: "2022 • 139 мин",
    genre: ["action", "adventure", "comedy"]
  },
  { 
    name: "Top Gun: Maverick", 
    category: "movies", 
    image: "topgun.jpg", 
    yearOrSeason: "2022 • 130 мин",
    genre: ["action", "drama"]
  },
  { 
    name: "House of the Dragon", 
    category: "tv", 
    image: "hotd.jpg", 
    yearOrSeason: "Улирал: 2 • Анги: 8",
    genre: ["action", "adventure", "drama"]
  },
  { 
    name: "The Bear", 
    category: "tv", 
    image: "thebear.jpg", 
    yearOrSeason: "Улирал: 3 • Анги: 10",
    genre: ["comedy", "drama"]
  },
  { 
    name: "Succession", 
    category: "tv", 
    image: "succession.jpg", 
    yearOrSeason: "Улирал: 4 • Анги: 10",
    genre: ["drama"]
  }
];// State management
let currentFilters = {
    category: 'all',
    genres: [], // Array for multiple genres
    search: ''
};

// Function to render movies with current filters
function renderMovies() {
    const container = document.getElementById('movies-container');
    container.innerHTML = '';
    
    let filteredMovies = [...database];
    
    // Apply category filter
    if (currentFilters.category !== 'all') {
        filteredMovies = filteredMovies.filter(movie => 
            movie.category === currentFilters.category
        );
    }
    
    // Apply MULTI-GENRE filter (AND logic)
    if (currentFilters.genres.length > 0) {
        filteredMovies = filteredMovies.filter(movie => {
            // Check if movie has ALL selected genres
            return currentFilters.genres.every(selectedGenre => 
                movie.genre.includes(selectedGenre)
            );
        });
    }
    
    // Apply search filter
    if (currentFilters.search.trim() !== '') {
        const searchTerm = currentFilters.search.toLowerCase();
        filteredMovies = filteredMovies.filter(movie => 
            movie.name.toLowerCase().includes(searchTerm) ||
            movie.genre.some(g => g.toLowerCase().includes(searchTerm))
        );
    }
    
    // Update count
    updateItemsCount(filteredMovies.length);
    
    // Render movies
    filteredMovies.forEach(movie => {
        const movieCard = document.createElement('movie-card');
        movieCard.setAttribute('name', movie.name);
        movieCard.setAttribute('image', movie.image);
        movieCard.setAttribute('year-or-season', movie.yearOrSeason);
        movieCard.setAttribute('category', movie.category);
        movieCard.setAttribute('genre', movie.genre.join(', '));
        container.appendChild(movieCard);
    });
    
    // Update active filters display
    updateActiveFilters();
    
    // Update selected state
    updateSelectedState();
    
    // Observe new cards for lazy loading
    observeMovieCards();
}

// Update selected state (simplified - no numbers)
function updateSelectedState() {
    const genreButtons = document.querySelectorAll('.genre-btn');
    genreButtons.forEach(button => {
        const genre = button.getAttribute('data-genre');
        if (currentFilters.genres.includes(genre)) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
}

// Function to update items count
function updateItemsCount(count) {
    let countElement = document.getElementById('items-count');
    if (!countElement) {
        countElement = document.createElement('div');
        countElement.id = 'items-count';
        countElement.className = 'items-count';
        document.querySelector('main').insertBefore(
            countElement, 
            document.getElementById('movies-container')
        );
    }
    
    // Show genre combination if multiple selected
    let genreText = '';
    if (currentFilters.genres.length > 0) {
        const genreNames = currentFilters.genres.map(g => 
            g.charAt(0).toUpperCase() + g.slice(1)
        );
        genreText = ` • ${genreNames.join(' + ')}`;
    }
    
    const categoryText = currentFilters.category === 'all' ? '' : 
        (currentFilters.category === 'movies' ? ' • Кино' : ' • TV Цуврал');
    
    countElement.innerHTML = `Нийт: <span>${count}</span> кино олдлоо${categoryText}${genreText}`;
}

// Function to update active filters display
function updateActiveFilters() {
    let filtersContainer = document.querySelector('.active-filters');
    if (!filtersContainer) {
        filtersContainer = document.createElement('div');
        filtersContainer.className = 'active-filters';
        const moviesGrid = document.getElementById('movies-container');
        document.querySelector('main').insertBefore(filtersContainer, moviesGrid);
    }
    
    filtersContainer.innerHTML = '';
    
    // Only show filters if something is actually filtered
    const hasActiveFilters = 
        currentFilters.category !== 'all' || 
        currentFilters.genres.length > 0 || 
        currentFilters.search.trim() !== '';
    
    if (!hasActiveFilters) {
        filtersContainer.style.display = 'none';
        return;
    }
    
    filtersContainer.style.display = 'flex';
    
    // Add category filter badge
    if (currentFilters.category !== 'all') {
        const categoryName = currentFilters.category === 'movies' ? 'Кино' : 'TV Цуврал';
        const badge = document.createElement('div');
        badge.className = 'filter-badge';
        badge.innerHTML = `${categoryName} <span class="remove" data-filter="category">×</span>`;
        filtersContainer.appendChild(badge);
    }
    
    // Add genre filter badges (simple, no numbers)
    if (currentFilters.genres.length > 0) {
        currentFilters.genres.forEach(genre => {
            const genreName = genre.charAt(0).toUpperCase() + genre.slice(1);
            const badge = document.createElement('div');
            badge.className = 'filter-badge';
            badge.innerHTML = `${genreName} <span class="remove" data-filter="genre" data-genre="${genre}">×</span>`;
            filtersContainer.appendChild(badge);
        });
    }
    
    // Add search filter badge
    if (currentFilters.search.trim() !== '') {
        const badge = document.createElement('div');
        badge.className = 'filter-badge';
        badge.innerHTML = `Хайлт: "${currentFilters.search}" <span class="remove" data-filter="search">×</span>`;
        filtersContainer.appendChild(badge);
    }
    
    // Add remove handlers
    filtersContainer.querySelectorAll('.remove').forEach(removeBtn => {
        removeBtn.addEventListener('click', (e) => {
            const filterType = e.target.getAttribute('data-filter');
            const specificGenre = e.target.getAttribute('data-genre');
            
            if (filterType === 'genre' && specificGenre) {
                // Remove specific genre from array
                currentFilters.genres = currentFilters.genres.filter(g => g !== specificGenre);
                updateSelectedState();
            } else {
                clearFilter(filterType);
            }
            
            renderMovies();
        });
    });
}

// Function to clear a specific filter
function clearFilter(filterType) {
    switch(filterType) {
        case 'category':
            currentFilters.category = 'all';
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === 'all') {
                    btn.classList.add('active');
                }
            });
            // Also clear all genres when category changes
            currentFilters.genres = [];
            updateSelectedState();
            break;
        case 'genre':
            // Clear ALL genres
            currentFilters.genres = [];
            updateSelectedState();
            break;
        case 'search':
            currentFilters.search = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            break;
    }
    renderMovies();
}

// Function to get all unique genres from database
function getAllGenres() {
    const allGenres = new Set();
    
    // Filter by current category first
    let moviesToCheck = [...database];
    if (currentFilters.category !== 'all') {
        moviesToCheck = moviesToCheck.filter(movie => 
            movie.category === currentFilters.category
        );
    }
    
    moviesToCheck.forEach(movie => {
        movie.genre.forEach(g => allGenres.add(g));
    });
    return Array.from(allGenres).sort();
}

// Create genre buttons dynamically
function createGenreButtons() {
    const genres = getAllGenres();
    const genreFilters = document.querySelector('.genre-filters');
    
    // Clear existing buttons
    genreFilters.innerHTML = '';
    
    // Add genre buttons
    genres.forEach(genre => {
        const button = document.createElement('button');
        button.className = 'genre-btn';
        button.setAttribute('data-genre', genre);
        button.textContent = genre.charAt(0).toUpperCase() + genre.slice(1);
        genreFilters.appendChild(button);
    });
    
    // Update selected state
    updateSelectedState();
}

// Initialize the page
document.addEventListener('DOMContentLoaded', () => {
    // Create initial genre buttons
    createGenreButtons();
    
    // Load all movies initially
    renderMovies();
    
    // CATEGORY FILTER HANDLERS
    document.querySelectorAll('.category-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            // Remove active class from all category buttons
            document.querySelectorAll('.category-btn').forEach(btn => 
                btn.classList.remove('active')
            );
            
            // Add active class to clicked button
            e.target.classList.add('active');
            
            // Update current category filter
            currentFilters.category = e.target.getAttribute('data-category');
            
            // Clear all genres when category changes
            currentFilters.genres = [];
            
            // Recreate genre buttons for new category
            createGenreButtons();
            
            // Re-render movies
            renderMovies();
            
            // Re-attach genre button handlers
            attachGenreHandlers();
        });
    });
    
    // Attach genre button handlers
    function attachGenreHandlers() {
        document.querySelectorAll('.genre-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const selectedGenre = e.target.getAttribute('data-genre');
                
                // Toggle genre in array
                if (currentFilters.genres.includes(selectedGenre)) {
                    // Remove if already selected
                    currentFilters.genres = currentFilters.genres.filter(g => g !== selectedGenre);
                } else {
                    // Add if not selected
                    currentFilters.genres.push(selectedGenre);
                }
                
                // Update UI and render
                updateSelectedState();
                renderMovies();
            });
        });
    }
    
    // Initial attachment of genre handlers
    attachGenreHandlers();
    
    // SEARCH FUNCTIONALITY
    document.getElementById('search-input')?.addEventListener('input', (e) => {
        currentFilters.search = e.target.value;
        renderMovies();
    });
    
    // Clear all filters button (main clear button only)
    const clearAllBtn = document.createElement('button');
    clearAllBtn.className = 'clear-all-btn';
    clearAllBtn.textContent = 'Шүүлтүүрийг цэвэрлэх';
    clearAllBtn.style.cssText = `
        display: block;
        margin: 1rem auto;
        padding: 0.5rem 1rem;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        border-radius: 20px;
        cursor: pointer;
        font-family: 'Nunito', sans-serif;
        transition: all 0.3s ease;
    `;
    
    clearAllBtn.addEventListener('mouseenter', () => {
        clearAllBtn.style.background = 'rgba(255, 255, 255, 0.1)';
        clearAllBtn.style.transform = 'translateY(-2px)';
    });
    
    clearAllBtn.addEventListener('mouseleave', () => {
        clearAllBtn.style.background = 'transparent';
        clearAllBtn.style.transform = 'translateY(0)';
    });
    
    clearAllBtn.addEventListener('click', () => {
        // Reset all filters
        currentFilters = {
            category: 'all',
            genres: [],
            search: ''
        };
        
        // Reset UI
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-category') === 'all') {
                btn.classList.add('active');
            }
        });
        
        document.querySelectorAll('.genre-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        const searchInput = document.getElementById('search-input');
        if (searchInput) searchInput.value = '';
        
        createGenreButtons();
        renderMovies();
        attachGenreHandlers();
    });
    
    // Insert clear button
    const main = document.querySelector('main');
    main.insertBefore(clearAllBtn, document.getElementById('movies-container'));
});

// LAZY LOAD IMAGES
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target.shadowRoot?.querySelector('img');
            if (img && img.dataset.src) {
                img.src = img.dataset.src;
                img.removeAttribute('data-src');
            }
        }
    });
}, {
    rootMargin: '50px 0px',
    threshold: 0.1
});

function observeMovieCards() {
    setTimeout(() => {
        document.querySelectorAll('movie-card').forEach(card => {
            observer.observe(card);
        });
    }, 500);
}
</script>
</body>
</html>
</body>
</html>